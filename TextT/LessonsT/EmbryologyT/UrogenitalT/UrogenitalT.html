html<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="UrogenitalT" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="author" content="Jack D. Thatcher, Ph.D., West Virginia School of Osteopathic Medicine" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../../..//CommonFiles/MasterEmbryology.css">
    <link rel="stylesheet" href="../../../..//CommonFiles/MasterLessons.css">
    <link rel="stylesheet" href="../../../..//CommonFiles/LessonSpecificStylesheets/Urogenital.css">
    <title>Urogenital</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage-compat.js"></script>
</head>

<body>
    <div class="entireLesson">            <!-- Lesson Container, Menu and Animation -->
        <div class="lessonMenuPage" id="lessonMenuPage" onclick="nextSlide()">    <!-- Container for Menu & Footer -->

            <header>
                <h1>Urogenital Morphogenesis</h1>
            </header>
            <div class="viScript">
                <a onclick='executeClickNewWindow("viUrogenital.html")'>Script for the Visually Impaired</a>
            </div>

            <!-- Header Button Bank -->
            <div class="headBank">
                <a><img class="btnHeader" id="btnToCentralMenu" src="../../../..//CommonFiles/Buttons/BTN_ToCentralMenu.jpg" onclick='executeClick("../../../CentralMenuT.html")'><span class="sr-only">Return to Main Menu</span></a>
                <a><img class="btnHeader" id="btnTogTextLessonMenuX" src="../../../..//CommonFiles/Buttons/BTN_TogLessonMenuX.jpg" onclick='executeClick("../../../../TextX/LessonsX/EmbryologyX/UrogenitalX/UrogenitalX.html")'><span class="sr-only">Hide Explanatory Text</span></a>
                <a><img class="btnHeader" id="btnToPopUps" src="../../../..//CommonFiles/Buttons/BTN_PopUp.jpg" onclick='executeClick("PopUpsUrogenitalT.html")'></img></a>
                <a><img class="btnHeader" id="btnExcerpts" src="../../../..//CommonFiles/Buttons/BTN_Excerpts.jpg" onclick='executeClick("ExcerptsUrogenitalT.html")'><span class="sr-only">Excerpts</span></a>
                <a><img class="btnHeader" id="btnQuestions" src="../../../..//CommonFiles/Buttons/BTN_Questions.jpg" onclick='executeClick("QuestionsUrogenitalT.html")'><span class="sr-only">Practice Questions</span></a>
                <a><img class="btnHeader" id="btnFeedback" src="../../../..//CommonFiles/Buttons/BTN_Feedback.jpg" onclick='executeClick("FeedbackUrogenitalT.html")'><span class="sr-only">Provide Feedback</span></a>
            </div>

            <!-- Lesson Menu -->
            <div class="lessonMenu">
                <div class="group1">
                    <ul class="menuLists">
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <li><button id="menu1" class="linksLarge">Renal System</button></li>
                            <li><button id="menu2" class="linksSmall">Mesoderms</button></li>
                            <li><button id="menu3" class="linksSmall">Pronephros</button></li>
                            <li><button id="menu4" class="linksSmall">Mesonephros</button></li>
                            <li><button id="menu5" class="linksSmall">Metanephros</button></li>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <li><button id="menu6" class="linksLarge">Kidney</button></li>
                            <li><button id="menu7" class="linksSmall">Collecting System</button></li>
                            <li><button id="menu8" class="linksSmall">Excretory System</button></li>
                            <li><button id="menu9" class="linksSmall">Ascent</button></li>
                    </ul>
                </div>
                <div class="group2">
                    <ul class="menuLists">
                        <li><button id="menu10" class="linksLarge">Reproductive Systems</button></li>
                            <li><button id="menu11" class="linksSmall">Primordial Germ Cells</button></li>
                        <br>
                        <br>
                        <br>
                        <li><button id="menu12" class="linksLarge">Gonads</button></li>
                            <li><button id="menu13" class="linksSmall">Sex Cords</button></li>
                            <li><button id="menu14" class="linksSmall">Testis Cords/Follicles</button></li>
                            <li><button id="menu15" class="linksSmall">Testis/Ovary</button></li>
                        <br>
                        <br>
                        <br>
                        <li><button id="menu16" class="linksLarge">Glands/Vagina</button></li>
                            <li><button id="menu17" class="linksSmall">Gonad Descent</button></li>
                            <li><button id="menu18" class="linksSmall">Genitalia, Medial Section</button></li>
                            <li><button id="menu19" class="linksSmall">Genitalia, External</button></li>
                        <br>
                        <br>
                        <br>
                        <li><button id="menu20" class="linksLarge">Finale</button></li>
                    </ul>
                </div>
            </div>

            <!-- Footer -->
            <div class="footerLinks">
               <a onclick='executeClick("CitationsUrogenitalT.html")'>Citations</a>
            </div>
        </div>

        <!-- Lesson -->
        <div id="lesson" class="lesson">
            <div class="animation" id="animation" onclick="nextSlide()">
                <video class="video" id="videoId">
				    Video tag not supported
                </video>
            </div>
            <div class="lessonButtons">
                <a><img class="btnFooter" id="btnLessonMenu" src="../../../..//CommonFiles/Buttons/BTN_LessonMenu.jpg" onclick="self.location.href='UrogenitalT.html'"><span class="sr-only">Return to Main Menu</span></a>
                <a><img class="btnFooter" id="btnBack" src="../../../..//CommonFiles/Buttons/BTN_Back.jpg"><span class="sr-only">Go back to last scene</span></a>
                <a><img class="btnFooter btnRate" id="btnSlower" src="../../../..//CommonFiles/Buttons/BTN_Slow.jpg" onclick="slowDown('videoId')"><span class="sr-only">Slow Down</span></a>
                <a><img class="btnFooter btnRate" id="btnFaster" src="../../../..//CommonFiles/Buttons/BTN_Fast.jpg" onclick="speedUp('videoId')"><span class="sr-only">Speed Up</span></a>

                <a><img class="btnFooter btnSide" id="btnSideNephronReabsorption" src="NephronReabsorption/BTN_NephronReabsorption.jpg"><span class="sr-only">Nephron Reabsorption Ancillary Lesson</span></a>
                <a><img class="btnFooter btnSide" id="btnSideMultiplier" src="Multiplier/BTN_Multiplier.jpg"><span class="sr-only">Counter Current Multiplier Ancillary Lesson</span></a>
                <a><img class="btnFooter btnSide" id="btnSideHorseshoe" src="Horseshoe/BTN_Horseshoe.jpg"><span class="sr-only">Horseshoe Kidney Ancillary Lesson</span></a>
                <a><img class="btnFooter btnSide" id="btnSideTestesDescent" src="TestesDescent/BTN_TestesDescent.jpg"><span class="sr-only">Testes Descent Ancillary Lesson</span></a>
            </div>
        </div>

        <!-- Side Lesson -->
        <div class="side" id="sideNephronReabsorption">
            <div class="sideAnimation" id="sideAnimationNephronReabsorption" onclick="nextSlideSide()">
                <video class="video" id="sideVideoNephronReabsorption" muted autoplay nodownload>
                    <source id="sideSrcNephronReabsorption" src='NephronReabsorption/NephronReabsorptionT.mp4' type="video/mp4">
                    Video tag not supported
                </video>
            </div>
            <div class="lessonButtons">
                <a><img class="btnFooter btnSideBack" id="btnSideBackNephronReabsorption" src="../../../..//CommonFiles/Buttons/BTN_Back.jpg"><span class="sr-only">Go back to last scene</span></a>
            </div>
        </div>

        <div class="side" id="sideMultiplier">
            <div class="sideAnimation" id="sideAnimationMultiplier" onclick="nextSlideSide()">
                <video class="video" id="sideVideoMultiplier" muted autoplay nodownload>
                    <source id="sideSrcMultiplier" src='Multiplier/MultiplierT.mp4' type="video/mp4">
                    Video tag not supported
                </video>
            </div>
            <div class="lessonButtons">
                <a><img class="btnFooter btnSideBack" id="btnSideBackMultiplier" src="../../../..//CommonFiles/Buttons/BTN_Back.jpg"><span class="sr-only">Go back to last scene</span></a>
            </div>
        </div>

        <div class="side" id="sideHorseshoe">
            <div class="sideAnimation" id="sideAnimationHorseshoe" onclick="nextSlideSide()">
                <video class="video" id="sideVideoHorseshoe" muted autoplay nodownload>
                    <source id="sideSrcHorseshoe" src='Horseshoe/HorseshoeT.mp4' type="video/mp4">
                    Video tag not supported
                </video>
            </div>
            <div class="lessonButtons">
                <a><img class="btnFooter btnSideBack" id="btnSideBackHorseshoe" src="../../../..//CommonFiles/Buttons/BTN_Back.jpg"><span class="sr-only">Go back to last scene</span></a>
            </div>
        </div>

        <div class="side" id="sideTestesDescent">
            <div class="sideAnimation" id="sideAnimationTestesDescent" onclick="nextSlideSide()">
                <video class="video" id="sideVideoTestesDescent" muted autoplay nodownload>
                    <source id="sideSrcTestesDescent" src='TestesDescent/TestesDescentT.mp4' type="video/mp4">
                    Video tag not supported
                </video>
            </div>
            <div class="lessonButtons">
                <a><img class="btnFooter btnSideBack" id="btnSideBackTestesDescent" src="../../../..//CommonFiles/Buttons/BTN_Back.jpg"><span class="sr-only">Go back to last scene</span></a>
            </div>
        </div>
    </div>
</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
    // Initialize Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyB0KbGW-4znfF19ikrUahdCyd_bEungkH4",
        authDomain: "biome-865cc.firebaseapp.com",
        projectId: "biome-865cc",
        storageBucket: "biome-865cc.firebasestorage.app",
        messagingSenderId: "952652458408",
        appId: "1:952652458408:web:23e7f0689e9cf973be959d"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Load srcArray from Firestore
    async function loadSrcArray(lessonId) {
        try {
            // First, get videoPath from videoPaths collection
            const videoPathDoc = await db.collection("videoPaths").doc(lessonId).get();
            let videoPath;
            
            if (videoPathDoc.exists && videoPathDoc.data().videoPath) {
                videoPath = videoPathDoc.data().videoPath;
            } else {
                // Fall back to default path
                videoPath = `videos/${lessonId}.mp4`;
            }
            
            // Extract video filename from videoPath (e.g., "videos/filename.mp4" â†’ "filename")
            const match = videoPath.match(/videos\/([^\/]+)\.mp4$/);
            if (!match) {
                console.error("Invalid video path format:", videoPath);
                return [];
            }
            const videoFilename = match[1]; // Video filename without extension
            
            // Get srcArray from lessons collection using video filename (not lessonId)
            const videoDoc = await db.collection("lessons").doc(videoFilename).get();
            if (!videoDoc.exists) {
                console.error("Video document not found:", videoFilename);
                return [];
            }
            
            return videoDoc.data().srcArray || [];
        } catch (error) {
            console.error("Error loading srcArray:", error);
            return [];
        }
    }

    // Load video URL from Firebase Storage
    async function loadVideoUrl(lessonId) {
        try {
            // Check videoPaths collection for custom videoPath
            const videoPathDoc = await db.collection("videoPaths").doc(lessonId).get();
            let videoPath;
            
            if (videoPathDoc.exists && videoPathDoc.data().videoPath) {
                // Use custom video path from videoPaths collection
                videoPath = videoPathDoc.data().videoPath;
            } else {
                // Fall back to default path
                videoPath = `videos/${lessonId}.mp4`;
            }
            
            const storageRef = firebase.storage().ref();
            const fileRef = storageRef.child(videoPath);
            return await fileRef.getDownloadURL();
        } catch (error) {
            console.error('Error loading video URL:', error);
            // Return null if video doesn't exist, don't break the page
            return null;
        }
    }

    // Load masterUIcontrol.js first
    const masterUIScript = document.createElement('script');
    masterUIScript.src = '../../../..//CommonFiles/masterUIcontrol.js';
    document.body.appendChild(masterUIScript);
    
    masterUIScript.onload = function() {
        // Load srcArray from Firestore and initialize player
        (async () => {
            const lessonId = "urogenital_t";

            const srcArray = await loadSrcArray(lessonId);
            const videoUrl = await loadVideoUrl(lessonId);

            console.log("Loaded timing array:", srcArray);
            console.log("Loaded video URL:", videoUrl);

            // Always initialize player to set window.srcArray (required by masterUIcontrol.js)
            if (videoUrl && srcArray && srcArray.length > 0) {
                initializePlayer(videoUrl, srcArray);
            } else {
                console.warn("Video URL or srcArray missing. Video URL:", videoUrl, "srcArray length:", srcArray ? srcArray.length : 0);
                // Always initialize with at least empty array to prevent "srcArray is not defined" errors
                initializePlayer(videoUrl || "", srcArray || []);
            }

            // Load lesson-specific script
            const lessonScript = document.createElement('script');
            lessonScript.src = 'UrogenitalT.js';
            document.body.appendChild(lessonScript);
            
            // Load side lesson scripts if needed
            const nephronScript = document.createElement('script');
            nephronScript.src = 'NephronReabsorption/NephronReabsorptionT_src_array.js';
            document.body.appendChild(nephronScript);
            
            const multiplierScript = document.createElement('script');
            multiplierScript.src = 'Multiplier/MultiplierT_src_array.js';
            document.body.appendChild(multiplierScript);
            
            const horseshoeScript = document.createElement('script');
            horseshoeScript.src = 'Horseshoe/HorseshoeT_src_array.js';
            document.body.appendChild(horseshoeScript);
            
            const testesScript = document.createElement('script');
            testesScript.src = 'TestesDescent/TestesDescentT_src_array.js';
            document.body.appendChild(testesScript);
        })();
    };
</script>
</html>
